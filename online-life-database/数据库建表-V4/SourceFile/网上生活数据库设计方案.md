# 网上生活数据库设计方案

用户管理
☑ 管理员、客户和代办人员实名注册
☑ 各类用户账号信息修改
☑ 客户和代办人员信誉管理
☑ 客户和代办人员积分管理
客户
☑ 个性化代办事宜下单：
☑ 订单类型：及时订单、预约订单
☑ 需办事务：送货、取货、代买、排队取物品、接送他人等
批量待办事宜：参与团办
☑ 查询已发布的团办事宜
☑ 参团
☑ 付款



## 综述：
在订单创建环节，客户下单时系统依订单类型自动匹配代办人员，匹配依据是代办人员的信誉、积分、历史完成情况等，以确保任务分配的合理性。任务分配时，系统更新事务表的分配状态，代办人员接收并确认任务后开始处理。任务完成后，代办人员提交完成信息，客户确认，系统更新任务状态。
在抢单流程中，客户下单并设置抢单截止时间后，订单进入抢单池供代办人员抢单。系统记录每个抢单请求的时间和代办人员信息，按信誉、积分等排序，选定代办人员。抢单成功的代办人员接收任务并确认处理，完成后提交信息，客户确认，系统更新任务状态。

**为了实现这个项目的基础功能我们设计了六个实体：**
用户，订单，事务，信誉(可选)，积分，团办事宜

**为了实现“派单，抢单”的创新功能：**
我在原有数据库模型的基础上，增加以下字段和表：

1. **订单（Order）**
   - 增加字段：
     - 分配方式（AssignmentType）：派单、抢单
     - 分配状态（AssignmentStatus）：未分配、已分配、已完成
2. **事务（Task）**
   - 增加字段：
     - 抢单截止时间（BidDeadline）
     - 当前抢单人（CurrentBidder）
     - 抢单状态（BidStatus）：开放、已关闭
3. **抢单记录（BidRecord）**
   - 新增表：
     - 抢单ID（BidID）：主键
     - 事务ID（TaskID）：外键，关联到事务表
     - 用户ID（UserID）：外键，关联到用户表
     - 抢单时间（BidTime）
     - 抢单状态（BidStatus）：成功、失败



## 应用需求与设计分析：


### 1.订单实体

#### （一）设计原因
订单是整个系统的核心业务对象。设计订单实体是为了完整记录客户发起的每一个服务请求的详细信息，方便进行任务管理和跟踪。

#### （二）属性分配
- **订单ID**：作为订单的唯一标识，便于在系统中快速定位和查询特定订单，是订单管理的基础。
- **客户ID**：关联到客户实体，明确订单是由哪个客户发起的，有助于实现客户订单的统一管理。
- **订单类型**：区分及时订单和预约订单，影响系统的任务调度逻辑，如及时订单需要尽快分配处理，而预约订单则需要按照预约时间进行安排。
- **订单状态**：反映订单的当前处理进度，从创建到完成的各个阶段，方便客户和代办人员了解订单的实时情况，同时为系统的业务逻辑控制提供依据，例如只有处于特定状态的订单可以进行抢单或派单操作。

### 2.事务实体

#### （一）设计原因
事务是对订单的具体工作内容的细化，一个订单可能包含多个事务，通过设计事务实体可以清晰地分解任务，明确代办人员的工作内容和要求。

#### （二）属性分配
- **事务ID**：唯一标识每个事务，便于对事务进行精细化管理，特别是在抢单模式下，代办人员针对具体的事务进行抢单操作。
- **订单ID**：建立与订单的关联，明确该事务属于哪个订单的一部分，方便进行任务汇总和进度跟踪。
- **事务类型**：详细描述事务的具体内容，如送货、取货等，让代办人员清楚了解任务要求，同时也为系统的智能推荐和任务匹配提供依据。
- **预计时间和实际时间**：预计时间用于代办人员提前规划工作，合理安排任务顺序；实际时间用于记录任务完成情况，评估代办人员的工作效率，为后续的任务分配和信誉评价提供参考。

### 3.用户实体

#### （一）设计原因
系统涉及多种角色，包括客户和代办人员等，设计用户实体是为了统一管理所有参与者的身份信息和权限，实现个性化的功能展示和操作控制。

#### （二）属性分配
- **用户ID**：作为用户的唯一标识，在系统中建立与订单、事务、信誉和积分等其他实体的关联关系，实现数据的整合和共享。
- **用户名、密码、邮箱、电话和地址**：记录用户的基本联系信息，便于系统与用户进行沟通和交互，如发送订单通知、任务提醒等。
- **角色**：确定用户在系统中的身份，如客户或代办人员，根据角色赋予不同的操作权限，确保系统的安全性和业务逻辑的正确性。

### 4.信誉实体

#### （一）设计原因
信誉是衡量代办人员服务质量的重要指标，设计信誉实体可以激励代办人员提供高质量的服务，同时帮助客户选择合适的代办人员。

#### （二）属性分配
- **代办人员ID**：关联到用户实体中的代办人员，精准定位每个代办人员的信誉记录，为信誉评价提供数据基础。
- **信誉分数和评价**：量化代办人员的服务质量，信誉分数可以直观地反映代办人员的综合表现，评价则提供了具体的反馈信息，帮助代办人员了解自身的优点和不足，同时也为客户的决策提供参考。

### 5.积分实体

#### （一）设计原因
积分用于激励用户参与系统活动，提高用户的活跃度和忠诚度，设计积分实体可以灵活地管理用户的积分获取和消耗规则。

#### （二）属性分配
- **用户ID**：关联到用户实体，无论是客户还是代办人员，都可以根据系统规则获得积分，积分记录与用户绑定，方便进行积分的累计和查询。
- **积分值**：反映用户在系统中的积分总量，代办人员可以通过完成任务获得积分，客户可能通过发布订单或其他互动行为获取积分，积分可用于兑换奖励或享受优先服务等。

### 6.团单实体

#### （一）设计原因
团单是为了满足多个客户共同发起任务的需求，设计团单实体可以实现任务的批量处理和资源的共享，提高任务的执行效率和经济效益。

#### （二）属性分配
- **团单ID**：唯一标识每个团单，方便对团单进行管理和操作，如查看团单详情、修改团单信息等。
- **事务ID**：关联到具体的事务，明确团单所包含的工作内容，代办人员可以根据团单中的事务信息进行批量任务处理。
- **参与客户ID**：记录参与团单的客户信息，便于统计团单的参与人数，判断是否满足团单成立的条件，同时也方便在团单任务完成后进行结果的通知和反馈。



### 实体及其属性

1. **用户（User）**
   - 用户ID（UserID）：主键
   - 用户名（Username）
   - 密码（Password）
   - 邮箱（Email）
   - 电话（Phone）
   - 地址（Address）
   - 角色（Role）：管理员、客户、代办人员

2. **订单（Order）**
   - 订单ID（OrderID）：主键
   - 用户ID（UserID）：外键，关联到用户表
   - 订单类型（OrderType）：及时订单、预约订单
   - 订单状态（OrderStatus）：待处理、处理中、已完成
   - 创建时间（CreationTime）
   - 完成时间（CompletionTime）

3. **事务（Task）**
   - 事务ID（TaskID）：主键
   - 订单ID（OrderID）：外键，关联到订单表
   - 事务类型（TaskType）：送货、取货、代买等
   - 详细描述（Description）
   - 预计时间（EstimatedTime）
   - 实际时间（ActualTime）

4. **信誉（Reputation）**
   - 用户ID（UserID）：主键，关联到用户表
   - 信誉分数（Score）
   - 评价（Review）

5. **积分（Points）**
   - 用户ID（UserID）：主键，关联到用户表
   - 积分（Points）

6. **团办事宜（GroupTask）**
   - 团办ID（GroupTaskID）：主键
   - 事务ID（TaskID）：外键，关联到事务表
   - 参与用户ID（ParticipatingUserID）：外键，关联到用户表
   - 参团时间（JoinTime）

### 实体之间的关系

1. **用户与订单**
   - 一个用户可以有多个订单（一对多关系）
   - 用户ID是订单的外键

2. **订单与事务**
   - 一个订单可以包含多个事务（一对多关系）
   - 订单ID是事务的外键

3. **用户与信誉**
   - 一个用户有一个信誉记录（一对一关系）
   - 用户ID是信誉的外键

4. **用户与积分**
   - 一个用户有一个积分记录（一对一关系）
   - 用户ID是积分的外键

5. **团办事宜与事务**
   - 一个事务可以被多个团办事宜引用（多对一关系）
   - 事务ID是团办事宜的外键

6. **团办事宜与用户**
   - 一个团办事宜可以由多个用户参与（多对多关系）
   - 需要一个中间表来存储团办事宜和用户的关联信息

### 中间表（GroupTaskParticipation）

- 团办ID（GroupTaskID）：外键，关联到团办事宜表
- 用户ID（UserID）：外键，关联到用户表
